# Phase 1 完整指南：Google Form + Sheet 建置

**目標**: 建立完整的打卡表單與後台數據處理系統（支援 100 位學員）

---

## 📋 目錄

1. [建立 Google Form 表單](#步驟-1-建立-google-form-表單)
2. [建立 Google Sheet 工作表結構](#步驟-2-建立-google-sheet-工作表結構)
3. [設定 Sheet 公式與計算邏輯](#步驟-3-設定-sheet-公式與計算邏輯)
4. [產生測試資料與驗證](#步驟-4-產生測試資料與驗證)
5. [設定自動執行觸發器](#步驟-5-設定自動執行觸發器)
6. [產生 Sheet 公開連結](#步驟-6-產生-sheet-公開連結)
7. [效能優化說明（100 位學員）](#效能優化說明)

---

## 步驟 1: 建立 Google Form 表單

### 1.1 創建新表單

1. 前往 [Google Forms](https://forms.google.com)
2. 點擊「空白表單」創建新表單
3. 表單標題：**5週復盤陪跑班 - 每日打卡**

### 1.2 表單描述設定

```
📝 每日 10 分鐘，記錄你的間歇式日記
🔥 35 天養成習慣，我們一起見證彼此的成長！

打卡完成後，記得到儀表板看看其他同學的精彩分享 👉 [儀表板連結待補]
```

### 1.3 設定表單欄位

#### 欄位 1: 姓名 ✅ 必填
- **問題類型**: 下拉式選單
- **問題標題**: 姓名
- 勾選「必填」

#### 欄位 2: 打卡日期 ✅ 必填
- **問題類型**: 日期
- **問題標題**: 打卡日期
- 勾選「必填」

#### 欄位 3: 今天是否完成間歇式日記？✅ 必填
- **問題類型**: 單選題
- **選項**:
  - ✅ 是，已完成
  - ⏰ 晚點補
  - ❌ 今天跳過
- 勾選「必填」

#### 欄位 4: 今日一句話亮點 ✅ 必填
- **問題類型**: 簡答
- **說明文字**: 用一句話分享今天記錄或萃取的最大收穫（50 字內）
- **資料驗證**: 字元數最多 50 個字元
- 勾選「必填」

#### 欄位 5: 今天使用了哪種萃取法？
- **問題類型**: 單選題
- **選項**:
  - 📝 ORID 情緒萃取
  - 🎯 PAR 工作萃取
  - 📸 相片簿生活萃取
  - 🎙️ AI Podcast 訪談
  - ⏳ 只記錄，尚未萃取
- 選填

#### 欄位 6: 想對同學說的話
- **問題類型**: 段落
- 選填

### 1.4 表單設定

1. 點擊右上角「⚙️ 設定」
2. 在「回應」分頁：
   - ✅ 勾選「收集電子郵件地址」
   - ✅ 勾選「限制為 1 次回應」
3. 在「簡報」分頁：
   - 確認訊息：「✅ 打卡成功！記得到儀表板看看其他同學的分享！」
   - ✅ 顯示進度列

### 1.5 連結到 Google Sheet

1. 點擊「回應」分頁
2. 點擊「在 Google 試算表中檢視」綠色圖示
3. 選擇「建立新試算表」
4. 試算表名稱：**5週復盤陪跑班 - 打卡數據**
5. 點擊「建立」

---

## 步驟 2: 建立 Google Sheet 工作表結構

### 2.1 重新命名 Sheet 1

1. 在底部的工作表標籤「表單回應 1」上按右鍵
2. 選擇「重新命名」
3. 改名為：**表單回應**（注意：不要有多餘空格）

### 2.2 建立 Sheet 2: 學員名單

| A | B | C | D |
|---|---|---|---|
| 姓名 | 加入日期 | 狀態 | 備註 |

### 2.3 建立 Sheet 3: 打卡統計

| A | B | C | D | E | F | G | H |
|---|---|---|---|---|---|---|---|
| 姓名 | 累計打卡天數 | 連續打卡天數 | 最近打卡日期 | 7天達成 | 14天達成 | 21天達成 | 35天達成 |

### 2.4 建立 Sheet 4: 每日亮點牆

| A | B | C | D | E |
|---|---|---|---|---|
| 日期 | 姓名 | 一句話亮點 | 萃取法 | 額外分享 |

---

## 步驟 3: 設定 Sheet 公式與計算邏輯

### 3.1 打卡統計 - A 欄：學員名單

在 A2 儲存格輸入：
```excel
='學員名單'!A2
```
向下拖曳複製公式。

### 3.2 打卡統計 - B 欄：累計打卡天數

在 B2 儲存格輸入：
```excel
=COUNTIFS('表單回應'!$C:$C,$A2,'表單回應'!$E:$E,"✅ 是，已完成")
```

**重要**: C 欄是姓名（因為 B 欄是電子郵件），E 欄是是否完成狀態。

### 3.3 打卡統計 - D 欄：最近打卡日期

在 D2 儲存格輸入：
```excel
=IFERROR(MAXIFS('表單回應'!$D:$D,'表單回應'!$C:$C,$A2,'表單回應'!$E:$E,"✅ 是，已完成"),"")
```

### 3.4 打卡統計 - C 欄：連續打卡天數

**重要**: C 欄留空，不使用公式。我們使用優化版 Apps Script 批次更新。

### 3.5 打卡統計 - E-H 欄：里程碑達成

**E2 儲存格（7天達成）**:
```excel
=IF(C2>=7,"🏆","-")
```

**F2 儲存格（14天達成）**:
```excel
=IF(C2>=14,"🏆","-")
```

**G2 儲存格（21天達成）**:
```excel
=IF(C2>=21,"🏆","-")
```

**H2 儲存格（35天達成）**:
```excel
=IF(C2>=35,"🏆","-")
```

### 3.6 每日亮點牆 - 自動抓取資料

在 A2 儲存格輸入：
```excel
=QUERY('表單回應'!A:H,"SELECT D, C, F, G, H WHERE E = '✅ 是，已完成' ORDER BY D DESC",0)
```

---

## 步驟 4: 產生測試資料與驗證

### 4.1 設定 Apps Script（優化版）

1. 在 Google Sheet 中，點擊「擴充功能」→「Apps Script」
2. 刪除預設代碼
3. 複製 `scripts/apps-script-code-optimized.js` 的所有內容
4. 貼上並儲存

### 4.2 產生測試資料

**選項 A: 5 位學員（快速測試）**
```
函數下拉選單 → generateTestData5 → 執行
```

**選項 B: 100 位學員（實際規模）**
```
函數下拉選單 → generateTestData100 → 執行
```
⏱️ 執行時間：約 20-30 秒

### 4.3 更新連續打卡天數

每天執行一次（或設定自動觸發器）：
```
函數下拉選單 → updateAllConsecutiveDays → 執行
```
⏱️ 執行時間：約 5-10 秒（100 位學員）

### 4.4 清空測試資料

```
函數下拉選單 → clearTestData → 執行
```

---

## 步驟 5: 設定自動執行觸發器

### 5.1 建立時間觸發器

1. 在 Apps Script 編輯器左側，點擊「觸發條件」（時鐘圖示）
2. 點擊「+ 新增觸發條件」
3. 設定：

| 欄位 | 設定值 |
|-----|-------|
| 選擇要執行的函式 | `updateAllConsecutiveDays` |
| 選擇活動來源 | `時間驅動` |
| 選取時間型觸發條件類型 | `日計時器` |
| 選取時段 | `午夜 12 時至上午 1 時` |

4. 點擊「儲存」並授權

### 5.2 觸發器頻率建議

**推薦: 每天執行 3 次**
- 上午 8:00（學員開始打卡前更新昨日數據）
- 下午 14:00（中午休息時段更新）
- 晚上 23:00（一天結束前最後更新）

**不推薦**: 每小時執行
- 連續天數以「天」為單位，每小時更新無意義
- 增加 API 配額使用量

### 5.3 設定多個時段觸發器（可選）

使用 `scripts/設定多個自動觸發器.js` 中的 `createMultipleDailyTriggers()` 函數。

---

## 步驟 6: 產生 Sheet 公開連結

### 6.1 設定共用權限

1. 點擊 Google Sheet 右上角「共用」按鈕
2. 改為「知道連結的任何人」
3. 權限設為「檢視者」
4. 點擊「完成」

### 6.2 取得 CSV 公開連結

**格式**:
```
https://docs.google.com/spreadsheets/d/[SHEET_ID]/export?format=csv&gid=[GID]
```

**取得 gid**:
1. 點擊「打卡統計」工作表，看網址最後的 #gid= 後面的數字
2. 點擊「每日亮點牆」工作表，看網址最後的 #gid= 後面的數字

**範例連結**:
- 打卡統計: `https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/export?format=csv&gid=1618258511`
- 每日亮點牆: `https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/export?format=csv&gid=532678141`

---

## 效能優化說明

### 為什麼需要優化？

原版方案（每個學員用公式計算）：
- ❌ 100 個學員 = 100 次獨立計算
- ❌ 每次打開工作表需要 30-60 秒
- ❌ 效能瓶頸明顯

優化方案（批次處理）：
- ✅ 一次讀取所有資料
- ✅ 批次計算並寫入
- ✅ 手動/自動執行，避免載入延遲
- ✅ 執行時間：5-10 秒

### 效能對比

| 操作 | 學員數 | 記錄數 | 執行時間 |
|-----|-------|--------|---------|
| 產生測試資料 | 100 | 3,000+ | 20-30 秒 |
| 更新連續天數 | 100 | 3,000+ | 5-10 秒 |
| 開啟工作表 | 100 | 3,000+ | 2-3 秒 |
| 累計天數自動計算 | 100 | 3,000+ | 即時 |

### 哪些功能需要優化？

- ✅ **連續打卡天數（C 欄）**: 使用優化版批次處理
- ⭕ **累計天數（B 欄）**: COUNTIFS 效能好，保持公式
- ⭕ **最近日期（D 欄）**: MAXIFS 效能好，保持公式
- ⭕ **里程碑（E-H 欄）**: IF 公式效能好，保持公式
- ⭕ **亮點牆**: QUERY 效能好，保持公式

### 資料量評估

| 項目 | 預期數據 | Google Sheets 限制 | 使用率 |
|-----|---------|-------------------|--------|
| 打卡記錄數 | 3,500 筆 (100人×35天) | 500 萬行 | 0.07% |
| 儲存格數量 | 約 28,000 個 | 500 萬個儲存格 | 0.56% |

**結論**: Google Sheets 完全可以支援 100-300 位學員！✅

---

## Phase 1 完成檢查清單

- [ ] ✅ Google Form 表單已建立並設定所有欄位
- [ ] ✅ 表單已連結到 Google Sheet
- [ ] ✅ 建立了 4 個工作表：表單回應、學員名單、打卡統計、每日亮點牆
- [ ] ✅ 所有公式都已正確設定並運作
- [ ] ✅ Apps Script 優化版已建立並測試通過
- [ ] ✅ 測試資料已產生並驗證
- [ ] ✅ 自動觸發器已設定
- [ ] ✅ Google Sheet 已設為公開（檢視者）
- [ ] ✅ 已取得打卡統計和每日亮點牆的 CSV 公開連結

---

## 常見問題

**Q: Apps Script 函數執行很慢或超時？**
A: 使用優化版 `apps-script-code-optimized.js`，支援 100+ 學員。

**Q: 公式顯示 #REF! 錯誤？**
A: 檢查工作表名稱「表單回應」是否正確（注意不要有多餘空格）。

**Q: 連續打卡天數顯示 0？**
A: 確認：
1. Apps Script 已授權
2. 欄位順序正確：B 欄是電子郵件，C 欄是姓名，D 欄是日期，E 欄是狀態
3. 已執行 `updateAllConsecutiveDays` 函數

**Q: CSV 連結無法開啟？**
A: 確認 Google Sheet 的共用設定為「知道連結的任何人」+「檢視者」。

---

**下一步**: 完成 Phase 1 後，進入 Phase 2: Vibe 儀表板開發。
